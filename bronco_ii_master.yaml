# Master Wiring Diagram - Balanced Matrix for WireViz 0.4.1
style:
  graph:
    splines: ortho
    nodesep: 4.0
    ranksep: 3.0
    rankdir: LR

connectors:
  MS3_Pro: {pincount: 35, type: Ampseal, pinlabels: [GND, CANH, CANL]}
  MK60_ABS: {pincount: 47, type: Teves, pinlabels: [CANH, CANL]}
  Body_Module_J1: {pincount: 12, type: Deutsch_DTM, pinlabels: [VCC_F, GND_F, "", "", OUT1, OUT2, OUT3, OUT4, OUT5, OUT6, FB1, FB2]}
  Body_Module_J2: {pincount: 12, type: Deutsch_DTM, pinlabels: [VCC_L, GND_L, CANH, CANL, "", "", "", "", IN1, IN2, IN3, IN4]}
  Pi4_CAN_Hat: {pincount: 2, type: Header, pinlabels: [CANH, CANL]}
  Mirror_L: {pincount: 6, type: Ford_Plug, pinlabels: [H+, H-, COM, X, Y, PUD]}
  Atlas_Sensors: {pincount: 4, type: Micro-Fit, pinlabels: [S1, S2, VCC, GND]}
  Chassis_Ground: {pincount: 2, type: Stud} # Increased pincount to 2 for matrix balance

cables:
  Main_Harness:
    category: loom
    wirecount: 6
    color: BK
    colors: [WH, BU, RD, RD, BK, BK]
    shield: true

connections:
  # EVERY row is now a 2-pin to 2-wire to 2-pin matrix
  
  # CAN Backbone 1
    - [MS3_Pro: [2, 3], Main_Harness: [1, 2], MK60_ABS: [1, 2]]
  
  # CAN Backbone 2
    - [MK60_ABS: [1, 2], Main_Harness: [1, 2], Body_Module_J2: [3, 4]]
  
  # CAN Backbone 3
    - [Body_Module_J2: [3, 4], Main_Harness: [1, 2], Pi4_CAN_Hat: [1, 2]]
  
  # Grounding & Shield (Repeating pin 1 on the stud to maintain 2-pin width)
    - [MS3_Pro: [1, 1], Main_Harness: [s, s], Chassis_Ground: [1, 1]]

  # Peripheral Outputs (OUT1/2 to Mirror Heat)
    - [Body_Module_J1: [5, 6], Main_Harness: [3, 4], Mirror_L: [1, 2]]
  
  # Atlas Sensors (Using J2 IN3/4)
    - [Body_Module_J2: [11, 12], Main_Harness: [5, 6], Atlas_Sensors: [1, 2]]

visualizer:
visualizer:
  - rank: same
    nodes: [MS3_Pro, Main_Harness, MK60_ABS, Body_Module_J2, Pi4_CAN_Hat, Chassis_Ground, Body_Module_J1, Mirror_L, Atlas_Sensors]
  - rank: same
    nodes: [Body_Module_J1, Mirror_L, Atlas_Sensors, Chassis_Ground]